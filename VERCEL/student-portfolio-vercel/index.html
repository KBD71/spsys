<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í•™ìƒ í¬íŠ¸í´ë¦¬ì˜¤ ì‹œìŠ¤í…œ</title>

  <!-- MathJax for LaTeX support -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      options: {
        menuOptions: {
          settings: {
            texHints: true
          }
        }
      }
    };
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 900px;
      width: 100%;
      overflow: hidden;
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
      position: relative;
    }

    header h1 {
      font-size: 1.8rem;
      font-weight: 700;
    }

    main {
      padding: 30px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
    }

    input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
    }

    button {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #555;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .btn-danger {
      background: #ff6b6b;
      color: white;
    }

    .message {
      margin-top: 20px;
      padding: 12px;
      border-radius: 10px;
      display: none;
    }

    .message.show {
      display: block;
    }

    .message.success {
      background: #d4edda;
      color: #155724;
    }

    .message.error {
      background: #f8d7da;
      color: #721c24;
    }

    .message.info {
      background: #d1ecf1;
      color: #0c5460;
    }

    .info-card {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .info-card p {
      margin: 8px 0;
    }

    .info-box {
      background: #f0f4ff;
      border-left: 4px solid #667eea;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
    }

    .info-box ul {
      list-style: none;
      padding-left: 0;
    }

    .info-box li {
      padding: 5px 0;
      padding-left: 25px;
      position: relative;
    }

    .info-box li:before {
      content: "âœ“";
      position: absolute;
      left: 0;
      color: #667eea;
      font-weight: bold;
    }

    .btn-back {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      width: auto;
      margin: 0;
    }

    .btn-back:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    header h1 {
      padding: 0 80px;
    }

    small {
      display: block;
      margin-top: 5px;
      color: #888;
      font-size: 0.85rem;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
      margin-left: 10px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ê³¼ì œ ì¹´ë“œ */
    .assignment-card {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }

    .assignment-card:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
      transform: translateY(-2px);
    }

    .assignment-card h3 {
      margin-bottom: 10px;
      color: #333;
    }

    .assignment-card p {
      margin: 5px 0;
      color: #666;
      font-size: 0.9rem;
    }

    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-top: 10px;
    }

    .badge.submitted {
      background: #d4edda;
      color: #155724;
    }

    .badge.pending {
      background: #fff3cd;
      color: #856404;
    }

    /* ê¸°ë¡ ì¹´ë“œ */
    .record-card {
      background: #f8f9fa;
      border-left: 4px solid #667eea;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .record-card h3 {
      margin-bottom: 15px;
      color: #333;
    }

    .record-card .data-row {
      display: flex;
      padding: 8px 0;
      border-bottom: 1px solid #e0e0e0;
    }

    .record-card .data-row:last-child {
      border-bottom: none;
    }

    .record-card .data-label {
      font-weight: 600;
      color: #555;
      min-width: 120px;
    }

    .record-card .data-value {
      color: #333;
      flex: 1;
    }

    .feedback-box {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .feedback-box strong {
      color: #856404;
    }

    .suggestion-box {
      background: #e1f5fe;
      border-left: 4px solid #0288d1;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .suggestion-box strong {
      color: #01579b;
    }

    .suggestion-input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      resize: vertical;
      transition: border-color 0.3s ease;
      margin-bottom: 8px;
    }

    .suggestion-input:focus {
      border-color: #0288d1;
      outline: none;
    }

    .suggestion-save-btn {
      background: #0288d1;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .suggestion-save-btn:hover {
      background: #0277bd;
    }

    .suggestion-save-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 1rem;
      font-family: inherit;
      resize: vertical;
      min-height: 150px;
      transition: border-color 0.3s;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #999;
    }

    .empty-state svg {
      width: 60px;
      height: 60px;
      margin-bottom: 15px;
      opacity: 0.3;
    }

    /* ==================== í‰ê°€ ì‹œìŠ¤í…œ ìŠ¤íƒ€ì¼ ==================== */
    .teacher-info {
      background: #e8f5e8;
      border-left: 4px solid #28a745;
      padding: 1rem;
      margin-bottom: 2rem;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .teacher-info p {
      margin: 0;
      color: #155724;
      font-weight: 500;
    }

    .teacher-menu {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 2rem 0;
    }

    .teacher-menu button {
      padding: 1.5rem;
      font-size: 1.1rem;
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .manage-actions {
      margin-bottom: 2rem;
    }

    .evaluation-card {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }

    .evaluation-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .evaluation-card h4 {
      color: #667eea;
      margin-bottom: 0.5rem;
    }

    .evaluation-meta {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 1rem;
    }

    .evaluation-actions {
      display: flex;
      gap: 0.5rem;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .eval-item {
      display: grid;
      grid-template-columns: 2fr 1fr 2fr auto;
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      background: #f8f9fa;
      border-radius: 6px;
    }

    .eval-item input {
      margin-bottom: 0;
    }

    .eval-item button {
      background: #dc3545;
      color: white;
      border: none;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .score-selector {
      margin-bottom: 2rem;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .score-selector label {
      display: inline-block;
      margin-right: 1rem;
      font-weight: 500;
    }

    .score-selector select {
      min-width: 300px;
    }

    .evaluation-info {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 1rem;
      margin-bottom: 2rem;
      border-radius: 6px;
    }

    .evaluation-info h3 {
      margin: 0 0 0.5rem 0;
      color: #1976d2;
    }

    .evaluation-info p {
      margin: 0;
      color: #555;
    }

    .score-table-container {
      overflow-x: auto;
      margin-bottom: 2rem;
    }

    #scoreTable {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    #scoreTable th {
      background: #667eea;
      color: white;
      padding: 1rem;
      text-align: left;
      font-weight: 500;
    }

    #scoreTable td {
      padding: 0.75rem;
      border-bottom: 1px solid #eee;
    }

    #scoreTable tbody tr:hover {
      background: #f8f9fa;
    }

    .score-input {
      width: 80px;
      padding: 0.25rem 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      text-align: center;
    }

    .score-input:focus {
      border-color: #667eea;
      outline: none;
    }

    .comment-input {
      width: 100%;
      min-width: 120px;
      padding: 0.25rem 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.9rem;
    }

    .total-score {
      font-weight: bold;
      color: #667eea;
    }

    .score-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 2rem;
    }

    .evaluation-result-card {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .evaluation-result-card h3 {
      color: #667eea;
      margin-bottom: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .evaluation-score {
      background: #e8f5e8;
      color: #2e7d32;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: bold;
      font-size: 1.1rem;
    }

    .evaluation-items {
      margin-top: 1rem;
    }

    .evaluation-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid #eee;
    }

    .evaluation-item:last-child {
      border-bottom: none;
    }

    .item-name {
      font-weight: 500;
    }

    .item-score {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .item-score-value {
      font-weight: bold;
      color: #667eea;
    }

    .item-comment {
      font-size: 0.9rem;
      color: #666;
      font-style: italic;
      margin-top: 0.5rem;
    }

    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .eval-item {
        grid-template-columns: 1fr;
        gap: 0.25rem;
      }
      
      .teacher-menu {
        grid-template-columns: 1fr;
      }
      
      .score-table-container {
        font-size: 0.9rem;
      }
      
      .evaluation-actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <!-- ë¡œê·¸ì¸ í™”ë©´ -->
  <div id="loginScreen" class="container screen active">
    <header>
      <h1>ğŸ“ í•™ìƒ í¬íŠ¸í´ë¦¬ì˜¤</h1>
    </header>
    <main>
      <form id="loginForm">
        <div class="form-group">
          <label for="studentId">í•™ë²ˆ</label>
          <input type="text" id="studentId" pattern="[0-9]{5}" maxlength="5" placeholder="5ìë¦¬ ìˆ«ì" required>
          <small>5ìë¦¬ í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”</small>
        </div>

        <div class="form-group">
          <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" id="password" required>
        </div>

        <button type="submit" class="btn-primary" id="loginBtn">ë¡œê·¸ì¸</button>

        <div id="loginMessage" class="message"></div>
      </form>
    </main>
  </div>

  <!-- ë©”ë‰´ í™”ë©´ -->
  <div id="menuScreen" class="container screen">
    <header>
      <h1>ğŸ“ í•™ìƒ í¬íŠ¸í´ë¦¬ì˜¤</h1>
    </header>
    <main>
      <div class="info-card">
        <p><strong>ì´ë¦„:</strong> <span id="studentName">-</span></p>
        <p><strong>í•™ë²ˆ:</strong> <span id="studentIdDisplay">-</span></p>
        <p><strong>ë°˜:</strong> <span id="studentClass">-</span></p>
      </div>

      <button id="viewAssignmentsBtn" class="btn-primary">ğŸ“ ê³¼ì œ ëª©ë¡</button>
      <button id="viewRecordsBtn" class="btn-primary">ğŸ“Š ë‚´ ê¸°ë¡ ë³´ê¸°</button>
      <button id="viewEvaluationsBtn" class="btn-primary">ğŸ“ ë‚´ í‰ê°€ ê²°ê³¼</button>
      <button id="teacherModeBtn" class="btn-secondary">ğŸ‘¨â€ğŸ« êµì‚¬ ëª¨ë“œ</button>
      <button id="changePasswordBtn" class="btn-secondary">ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
      <button id="logoutBtn" class="btn-danger">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
    </main>
  </div>

  <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í™”ë©´ -->
  <div id="passwordScreen" class="container screen">
    <header style="position: relative;">
      <button id="backBtn" class="btn-back">â† ë’¤ë¡œ</button>
      <h1>ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h1>
    </header>
    <main>
      <form id="passwordForm">
        <div class="form-group">
          <label for="currentPassword">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" id="currentPassword" required>
        </div>

        <div class="form-group">
          <label for="newPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" id="newPassword" minlength="4" maxlength="20" required>
        </div>

        <div class="form-group">
          <label for="confirmPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <input type="password" id="confirmPassword" minlength="4" maxlength="20" required>
        </div>

        <div class="info-box">
          <strong>ğŸ“Œ ë¹„ë°€ë²ˆí˜¸ ê·œì¹™</strong>
          <ul>
            <li>ìµœì†Œ 4ì ì´ìƒ, ìµœëŒ€ 20ì</li>
            <li>í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ì™€ ë‹¬ë¼ì•¼ í•¨</li>
            <li>24ì‹œê°„ì— í•œ ë²ˆë§Œ ë³€ê²½ ê°€ëŠ¥</li>
          </ul>
        </div>

        <button type="submit" class="btn-primary" id="changeBtn">ë³€ê²½í•˜ê¸°</button>
        <button type="button" id="cancelBtn" class="btn-secondary">ì·¨ì†Œ</button>

        <div id="passwordMessage" class="message"></div>
      </form>
    </main>
  </div>

  <!-- ê³¼ì œ ëª©ë¡ í™”ë©´ -->
  <div id="assignmentsScreen" class="container screen">
    <header style="position: relative;">
      <button id="assignmentsBackBtn" class="btn-back">â† ë’¤ë¡œ</button>
      <h1>ğŸ“ ê³¼ì œ ëª©ë¡</h1>
    </header>
    <main>
      <div id="assignmentsList"></div>
      <div id="assignmentsMessage" class="message"></div>
    </main>
  </div>

  <!-- ê³¼ì œ ìƒì„¸/ì œì¶œ í™”ë©´ -->
  <div id="assignmentDetailScreen" class="container screen">
    <header style="position: relative;">
      <button id="detailBackBtn" class="btn-back">â† ë’¤ë¡œ</button>
      <h1>ğŸ“ ê³¼ì œ ì œì¶œ</h1>
    </header>
    <main>
      <div class="info-card" id="assignmentInfo"></div>
      <form id="assignmentForm">
        <div id="questionsContainer"></div>
        <button type="submit" class="btn-primary" id="submitAssignmentBtn">ì œì¶œí•˜ê¸°</button>
        <button type="button" id="cancelAssignmentBtn" class="btn-secondary">ì·¨ì†Œ</button>
        <div id="assignmentDetailMessage" class="message"></div>
      </form>
    </main>
  </div>

  <!-- ë‚´ ê¸°ë¡ ë³´ê¸° í™”ë©´ -->
  <div id="myRecordsScreen" class="container screen">
    <header style="position: relative;">
      <button id="recordsBackBtn" class="btn-back">â† ë’¤ë¡œ</button>
      <h1>ğŸ“Š ë‚´ ê¸°ë¡</h1>
    </header>
    <main>
      <div id="recordsList"></div>
      <div id="recordsMessage" class="message"></div>
    </main>
  </div>

  <!-- í•™ìƒ í‰ê°€ ê²°ê³¼ í™”ë©´ -->
  <div id="myEvaluationsScreen" class="container screen">
    <header style="position: relative;">
      <button id="evaluationsBackBtn" class="btn-back">â† ë’¤ë¡œ</button>
      <h1>ğŸ“ ë‚´ í‰ê°€ ê²°ê³¼</h1>
    </header>
    <main>
      <div id="evaluationsList"></div>
      <div id="evaluationsMessage" class="message"></div>
    </main>
  </div>

  <!-- êµì‚¬ ëª¨ë“œ í™”ë©´ -->
  <div id="teacherModeScreen" class="container screen">
    <header style="position: relative;">
      <button id="teacherBackBtn" class="btn-back">â† ë’¤ë¡œ</button>
      <h1>ğŸ‘¨â€ğŸ« êµì‚¬ ëª¨ë“œ</h1>
    </header>
    <main>
      <div class="teacher-info">
        <p>ğŸ” êµì‚¬ ëª¨ë“œë¡œ ë¡œê·¸ì¸ë¨</p>
        <button onclick="exitTeacherMode()" class="btn-danger">êµì‚¬ ëª¨ë“œ ì¢…ë£Œ</button>
      </div>
      
      <div class="teacher-menu">
        <button id="manageEvaluationsBtn" class="btn-primary">ğŸ“‹ í‰ê°€í•­ëª© ê´€ë¦¬</button>
        <button id="inputScoresBtn" class="btn-primary">âœï¸ ì ìˆ˜ ì…ë ¥</button>
        <button id="viewStatsBtn" class="btn-secondary">ğŸ“Š í†µê³„ ë³´ê¸°</button>
      </div>
    </main>
  </div>

  <!-- í‰ê°€í•­ëª© ê´€ë¦¬ í™”ë©´ -->
  <div id="evaluationManageScreen" class="container screen">
    <header style="position: relative;">
      <button id="manageBackBtn" class="btn-back">â† ë’¤ë¡œ</button>
      <h1>ğŸ“‹ í‰ê°€í•­ëª© ê´€ë¦¬</h1>
    </header>
    <main>
      <div class="manage-actions">
        <button id="newEvaluationBtn" class="btn-primary">â• ìƒˆ í‰ê°€ ìƒì„±</button>
      </div>
      
      <div id="evaluationManageList"></div>
      <div id="manageMessage" class="message"></div>

      <!-- ìƒˆ í‰ê°€ ìƒì„± ëª¨ë‹¬ -->
      <div id="newEvaluationModal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3>ìƒˆ í‰ê°€ ìƒì„±</h3>
            <button type="button" class="close-btn" onclick="hideNewEvaluationModal()">Ã—</button>
          </div>
          
          <div class="modal-body">
            <form id="newEvaluationForm" onsubmit="createNewEvaluation(event)">
              <div class="form-group">
                <label for="evalName">í‰ê°€ëª… *</label>
                <input type="text" id="evalName" required>
              </div>
              
              <div class="form-group">
                <label for="evalDescription">ì„¤ëª…</label>
                <textarea id="evalDescription" rows="3"></textarea>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="evalType">í‰ê°€ìœ í˜• *</label>
                  <select id="evalType" required>
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="ì§€í•„í‰ê°€">ì§€í•„í‰ê°€</option>
                    <option value="ìˆ˜í–‰í‰ê°€">ìˆ˜í–‰í‰ê°€</option>
                    <option value="í”„ë¡œì íŠ¸">í”„ë¡œì íŠ¸</option>
                    <option value="ë°œí‘œ">ë°œí‘œ</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="evalPoints">ì´ë°°ì  *</label>
                  <input type="number" id="evalPoints" min="1" required>
                </div>
              </div>
              
              <div class="form-group">
                <label for="evalTarget">ëŒ€ìƒë°˜ *</label>
                <select id="evalTarget" required>
                  <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                  <option value="ì „ì²´">ì „ì²´</option>
                  <option value="1í•™ë…„">1í•™ë…„</option>
                  <option value="2í•™ë…„">2í•™ë…„</option>
                  <option value="3í•™ë…„">3í•™ë…„</option>
                  <option value="1-1">1-1</option>
                  <option value="1-2">1-2</option>
                  <option value="2-1">2-1</option>
                  <option value="2-2">2-2</option>
                </select>
              </div>
              
              <div class="form-group">
                <label>ì„¸ë¶€ í‰ê°€í•­ëª©</label>
                <div id="evalItems">
                  <div class="eval-item">
                    <input type="text" placeholder="í•­ëª©ëª…" class="item-name" required>
                    <input type="number" placeholder="ë°°ì " class="item-points" min="1" required>
                    <input type="text" placeholder="í‰ê°€ê¸°ì¤€ (ì„ íƒ)" class="item-criteria">
                    <button type="button" onclick="removeEvalItem(this)">ì‚­ì œ</button>
                  </div>
                </div>
                <button type="button" onclick="addEvalItem()" class="btn-secondary">+ í•­ëª© ì¶”ê°€</button>
              </div>
              
              <div class="form-actions">
                <button type="submit" class="submit-btn">ìƒì„±í•˜ê¸°</button>
                <button type="button" onclick="hideNewEvaluationModal()" class="cancel-btn">ì·¨ì†Œ</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- ì ìˆ˜ ì…ë ¥ í™”ë©´ -->
  <div id="scoreInputScreen" class="container screen">
    <header style="position: relative;">
      <button id="scoreBackBtn" class="btn-back">â† ë’¤ë¡œ</button>
      <h1>âœï¸ ì ìˆ˜ ì…ë ¥</h1>
    </header>
    <main>
      <div class="score-selector">
        <label for="evaluationSelect">í‰ê°€ ì„ íƒ:</label>
        <select id="evaluationSelect" onchange="loadEvaluationForScoring()">
          <option value="">í‰ê°€ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
        </select>
      </div>
      
      <div id="scoreInputContent" class="hidden">
        <div class="evaluation-info">
          <h3 id="selectedEvalName"></h3>
          <p id="selectedEvalDesc"></p>
        </div>
        
        <div class="score-table-container">
          <table id="scoreTable">
            <thead>
              <tr>
                <th>í•™ë²ˆ</th>
                <th>ì´ë¦„</th>
                <th>ë°˜</th>
                <!-- ë™ì ìœ¼ë¡œ í‰ê°€í•­ëª© í—¤ë” ì¶”ê°€ -->
              </tr>
            </thead>
            <tbody>
              <!-- ë™ì ìœ¼ë¡œ í•™ìƒ ë°ì´í„° ì¶”ê°€ -->
            </tbody>
          </table>
        </div>
        
        <div class="score-actions">
          <button id="saveScoresBtn" class="btn-primary" onclick="saveAllScores()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
          <button id="previewStatsBtn" class="btn-secondary" onclick="previewStats()">ğŸ“Š í†µê³„ ë¯¸ë¦¬ë³´ê¸°</button>
        </div>
      </div>
      
      <div id="scoreMessage" class="message"></div>
    </main>
  </div>

  <!-- êµì‚¬ ë¡œê·¸ì¸ ëª¨ë‹¬ -->
  <div id="teacherLoginModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ğŸ‘¨â€ğŸ« êµì‚¬ ëª¨ë“œ ë¡œê·¸ì¸</h3>
        <button type="button" class="close-btn" onclick="hideTeacherLoginModal()">Ã—</button>
      </div>
      
      <div class="modal-body">
        <form id="teacherLoginForm" onsubmit="authenticateTeacher(event)">
          <div class="form-group">
            <label for="teacherPassword">êµì‚¬ ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="teacherPassword" required placeholder="êµì‚¬ ì „ìš© ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <small>êµì‚¬ë§Œ ì•Œê³  ìˆëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</small>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="submit-btn">ë¡œê·¸ì¸</button>
            <button type="button" onclick="hideTeacherLoginModal()" class="cancel-btn">ì·¨ì†Œ</button>
          </div>
        </form>
        <div id="teacherLoginMessage" class="message"></div>
      </div>
    </div>
  </div>

  <script>
    // API ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •
    const API_BASE = '/api';  // Vercel ë°°í¬ ì‹œ ìë™ìœ¼ë¡œ /apië¡œ ë¼ìš°íŒ…ë¨

    // ì „ì—­ ë³€ìˆ˜
    let currentStudentId = '';
    let currentStudentName = '';
    let currentStudentClass = '';
    let isTeacherMode = false;
    
    // êµì‚¬ ë¹„ë°€ë²ˆí˜¸ (ì‹¤ì œ ìš´ì˜ì‹œì—ëŠ” ì„œë²„ì—ì„œ ê´€ë¦¬)
    const TEACHER_PASSWORD = 'teacher2025!';

    // í™”ë©´ ì „í™˜
    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(screenId).classList.add('active');
    }

    // ë©”ì‹œì§€ í‘œì‹œ
    function showMessage(elementId, message, type) {
      const el = document.getElementById(elementId);
      el.textContent = message;
      el.className = 'message show ' + type;

      if (type !== 'info') {
        setTimeout(() => {
          el.className = 'message';
        }, 5000);
      }
    }

    // ë¡œê·¸ì¸
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const studentId = document.getElementById('studentId').value.trim();
      const password = document.getElementById('password').value.trim();
      const loginBtn = document.getElementById('loginBtn');

      if (!studentId || !password) {
        showMessage('loginMessage', 'í•™ë²ˆê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
        return;
      }

      if (!/^[0-9]{5}$/.test(studentId)) {
        showMessage('loginMessage', 'í•™ë²ˆì€ 5ìë¦¬ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
        return;
      }

      // ë¡œë”© ìƒíƒœ
      loginBtn.disabled = true;
      loginBtn.innerHTML = 'ë¡œê·¸ì¸ ì¤‘... <span class="loading"></span>';
      showMessage('loginMessage', 'ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘...', 'info');

      try {
        const response = await fetch(`${API_BASE}/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ studentId, password })
        });

        const result = await response.json();

        if (result.success) {
          currentStudentId = result.studentId;
          currentStudentName = result.name;
          currentStudentClass = result.class || '-';

          document.getElementById('studentName').textContent = result.name;
          document.getElementById('studentIdDisplay').textContent = result.studentId;
          document.getElementById('studentClass').textContent = result.class || '-';

          showScreen('menuScreen');
        } else {
          showMessage('loginMessage', result.message, 'error');
        }
      } catch (error) {
        console.error('Login error:', error);
        showMessage('loginMessage', 'ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        loginBtn.disabled = false;
        loginBtn.textContent = 'ë¡œê·¸ì¸';
      }
    });

    // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í™”ë©´ìœ¼ë¡œ
    document.getElementById('changePasswordBtn').addEventListener('click', function() {
      document.getElementById('passwordForm').reset();
      document.getElementById('passwordMessage').className = 'message';
      showScreen('passwordScreen');
    });

    // ë’¤ë¡œ ê°€ê¸°
    document.getElementById('backBtn').addEventListener('click', function() {
      showScreen('menuScreen');
    });

    document.getElementById('cancelBtn').addEventListener('click', function() {
      showScreen('menuScreen');
    });

    // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
    document.getElementById('passwordForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const currentPassword = document.getElementById('currentPassword').value.trim();
      const newPassword = document.getElementById('newPassword').value.trim();
      const confirmPassword = document.getElementById('confirmPassword').value.trim();
      const changeBtn = document.getElementById('changeBtn');

      if (!currentPassword || !newPassword || !confirmPassword) {
        showMessage('passwordMessage', 'ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
        return;
      }

      if (newPassword !== confirmPassword) {
        showMessage('passwordMessage', 'ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
        return;
      }

      if (newPassword.length < 4) {
        showMessage('passwordMessage', 'ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.', 'error');
        return;
      }

      if (currentPassword === newPassword) {
        showMessage('passwordMessage', 'ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ì™€ ë‹¬ë¼ì•¼ í•©ë‹ˆë‹¤.', 'error');
        return;
      }

      // ë¡œë”© ìƒíƒœ
      changeBtn.disabled = true;
      changeBtn.innerHTML = 'ë³€ê²½ ì¤‘... <span class="loading"></span>';
      showMessage('passwordMessage', 'ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì²˜ë¦¬ ì¤‘...', 'info');

      try {
        const response = await fetch(`${API_BASE}/change-password`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            studentId: currentStudentId,
            currentPassword,
            newPassword
          })
        });

        const result = await response.json();

        if (result.success) {
          showMessage('passwordMessage', result.message, 'success');
          setTimeout(() => {
            showScreen('menuScreen');
          }, 2000);
        } else {
          showMessage('passwordMessage', result.message, 'error');
        }
      } catch (error) {
        console.error('Change password error:', error);
        showMessage('passwordMessage', 'ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        changeBtn.disabled = false;
        changeBtn.textContent = 'ë³€ê²½í•˜ê¸°';
      }
    });

    // ë¡œê·¸ì•„ì›ƒ
    document.getElementById('logoutBtn').addEventListener('click', function() {
      if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        currentStudentId = '';
        currentStudentName = '';
        currentStudentClass = '';
        document.getElementById('loginForm').reset();
        document.getElementById('loginMessage').className = 'message';
        showScreen('loginScreen');
      }
    });

    // ê³¼ì œ ëª©ë¡ ë³´ê¸°
    document.getElementById('viewAssignmentsBtn').addEventListener('click', async function() {
      showScreen('assignmentsScreen');
      await loadAssignments();
    });

    document.getElementById('assignmentsBackBtn').addEventListener('click', function() {
      showScreen('menuScreen');
    });

    // ë‚´ ê¸°ë¡ ë³´ê¸°
    document.getElementById('viewRecordsBtn').addEventListener('click', async function() {
      showScreen('myRecordsScreen');
      await loadMyRecords();
    });

    document.getElementById('recordsBackBtn').addEventListener('click', function() {
      showScreen('menuScreen');
    });

    // ë‚´ í‰ê°€ ê²°ê³¼ ë³´ê¸°
    document.getElementById('viewEvaluationsBtn').addEventListener('click', async function() {
      showScreen('myEvaluationsScreen');
      await loadMyEvaluations();
    });

    document.getElementById('evaluationsBackBtn').addEventListener('click', function() {
      showScreen('menuScreen');
    });

    // êµì‚¬ ëª¨ë“œ
    document.getElementById('teacherModeBtn').addEventListener('click', function() {
      showTeacherLoginModal();
    });

    document.getElementById('teacherBackBtn').addEventListener('click', function() {
      showScreen('menuScreen');
    });

    // í‰ê°€í•­ëª© ê´€ë¦¬
    document.getElementById('manageEvaluationsBtn').addEventListener('click', async function() {
      showScreen('evaluationManageScreen');
      await loadEvaluationManageList();
    });

    document.getElementById('manageBackBtn').addEventListener('click', function() {
      showScreen('teacherModeScreen');
    });

    // ì ìˆ˜ ì…ë ¥
    document.getElementById('inputScoresBtn').addEventListener('click', async function() {
      showScreen('scoreInputScreen');
      await loadEvaluationList();
    });

    document.getElementById('scoreBackBtn').addEventListener('click', function() {
      showScreen('teacherModeScreen');
    });

    // ìƒˆ í‰ê°€ ìƒì„±
    document.getElementById('newEvaluationBtn').addEventListener('click', function() {
      showNewEvaluationModal();
    });

    // ê³¼ì œ ëª©ë¡ ë¡œë“œ
    async function loadAssignments() {
      const listEl = document.getElementById('assignmentsList');
      listEl.innerHTML = '<p style="text-align: center; color: #999;">ê³¼ì œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';

      try {
        const response = await fetch(`${API_BASE}/assignments?studentId=${currentStudentId}`);
        const result = await response.json();

        if (result.success) {
          if (result.assignments.length === 0) {
            listEl.innerHTML = '<div class="empty-state"><p>ë“±ë¡ëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>';
            return;
          }

          listEl.innerHTML = '';
          result.assignments.forEach(assignment => {
            const card = document.createElement('div');
            card.className = 'assignment-card';
            card.innerHTML = `
              <h3>${assignment.name}</h3>
              <p>ì‹œì‘ì¼: ${assignment.startDate || '-'}</p>
              <p>ë§ˆê°ì¼: ${assignment.dueDate || '-'}</p>
              <span class="badge ${assignment.submitted ? 'submitted' : 'pending'}">
                ${assignment.submitted ? 'âœ“ ì œì¶œì™„ë£Œ' : 'ë¯¸ì œì¶œ'}
              </span>
            `;
            card.addEventListener('click', () => {
              loadAssignmentDetail(assignment.id);
            });
            listEl.appendChild(card);
          });
        } else {
          showMessage('assignmentsMessage', result.message, 'error');
        }
      } catch (error) {
        console.error('Load assignments error:', error);
        showMessage('assignmentsMessage', 'ê³¼ì œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      }
    }

    // ê³¼ì œ ìƒì„¸ ë¡œë“œ
    let currentAssignmentId = '';

    async function loadAssignmentDetail(assignmentId) {
      currentAssignmentId = assignmentId;
      showScreen('assignmentDetailScreen');

      const infoEl = document.getElementById('assignmentInfo');
      const containerEl = document.getElementById('questionsContainer');
      infoEl.innerHTML = '<p style="color: #999;">ê³¼ì œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
      containerEl.innerHTML = '';

      try {
        const response = await fetch(`${API_BASE}/assignment-detail?assignmentId=${assignmentId}&studentId=${currentStudentId}`);
        const result = await response.json();

        if (result.success) {
          const assignment = result.assignment;
          infoEl.innerHTML = `
            <p><strong>ê³¼ì œëª…:</strong> ${assignment.name}</p>
            <p><strong>ì‹œì‘ì¼:</strong> ${assignment.startDate || '-'}</p>
            <p><strong>ë§ˆê°ì¼:</strong> ${assignment.dueDate || '-'}</p>
            ${result.submitted ? `<p><strong>ì œì¶œì¼ì‹œ:</strong> ${result.submittedAt || '-'}</p>` : ''}
          `;

          containerEl.innerHTML = '';
          result.questions.forEach((q, index) => {
            if (q.column === 'ì œì¶œì¼ì‹œ' || q.column === 'í•™ìƒí”¼ë“œë°±') {
              return; // ì œì¶œì¼ì‹œì™€ í•™ìƒí”¼ë“œë°±ì€ í‘œì‹œí•˜ì§€ ì•ŠìŒ
            }

            const formGroup = document.createElement('div');
            formGroup.className = 'form-group';
            formGroup.innerHTML = `
              <label for="q${index}">${q.question || q.column}</label>
              <textarea id="q${index}" name="${q.column}" rows="4">${q.answer || ''}</textarea>
            `;
            containerEl.appendChild(formGroup);
          });
        } else {
          showMessage('assignmentDetailMessage', result.message, 'error');
        }
      } catch (error) {
        console.error('Load assignment detail error:', error);
        showMessage('assignmentDetailMessage', 'ê³¼ì œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      }
    }

    document.getElementById('detailBackBtn').addEventListener('click', function() {
      showScreen('assignmentsScreen');
    });

    document.getElementById('cancelAssignmentBtn').addEventListener('click', function() {
      showScreen('assignmentsScreen');
    });

    // ê³¼ì œ ì œì¶œ
    document.getElementById('assignmentForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const submitBtn = document.getElementById('submitAssignmentBtn');
      const formData = new FormData(e.target);
      const answers = {};

      for (let [key, value] of formData.entries()) {
        answers[key] = value;
      }

      submitBtn.disabled = true;
      submitBtn.innerHTML = 'ì œì¶œ ì¤‘... <span class="loading"></span>';
      showMessage('assignmentDetailMessage', 'ê³¼ì œë¥¼ ì œì¶œí•˜ëŠ” ì¤‘...', 'info');

      try {
        const response = await fetch(`${API_BASE}/submit-assignment`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            studentId: currentStudentId,
            assignmentId: currentAssignmentId,
            answers: answers
          })
        });

        const result = await response.json();

        if (result.success) {
          showMessage('assignmentDetailMessage', result.message, 'success');
          setTimeout(() => {
            showScreen('assignmentsScreen');
            loadAssignments();
          }, 2000);
        } else {
          showMessage('assignmentDetailMessage', result.message, 'error');
        }
      } catch (error) {
        console.error('Submit assignment error:', error);
        showMessage('assignmentDetailMessage', 'ê³¼ì œ ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'ì œì¶œí•˜ê¸°';
      }
    });

    // ë‚´ ê¸°ë¡ ë¡œë“œ
    async function loadMyRecords() {
      const listEl = document.getElementById('recordsList');
      listEl.innerHTML = '<p style="text-align: center; color: #999;">ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';

      try {
        const response = await fetch(`${API_BASE}/my-records?studentId=${currentStudentId}`);
        const result = await response.json();

        if (result.success) {
          if (result.records.length === 0) {
            listEl.innerHTML = '<div class="empty-state"><p>ê³µê°œëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
            return;
          }

          listEl.innerHTML = '';
          result.records.forEach(record => {
            const card = document.createElement('div');
            card.className = 'record-card';

            let html = `<h3>${record.sheetName}</h3>`;

            // ë°ì´í„° í‘œì‹œ
            for (let [key, value] of Object.entries(record.data)) {
              if (key === 'í•™ë²ˆ' || key === 'ë°˜' || key === 'ì´ë¦„') continue;
              html += `
                <div class="data-row">
                  <div class="data-label">${key}:</div>
                  <div class="data-value">${value || '-'}</div>
                </div>
              `;
            }

            // í”¼ë“œë°± ìˆìœ¼ë©´ í‘œì‹œ
            if (record.hasFeedback && record.feedback) {
              html += `
                <div class="feedback-box">
                  <strong>ğŸ’¬ ë‚´ í”¼ë“œë°±:</strong>
                  <p style="margin-top: 8px;">${record.feedback}</p>
                </div>
              `;
            }

            // ê±´ì˜ì‚¬í•­ ì…ë ¥ ê¸°ëŠ¥ ì¶”ê°€
            if (record.hasSuggestion) {
              html += `
                <div class="suggestion-box">
                  <strong>ğŸ’¡ ê±´ì˜ì‚¬í•­:</strong>
                  <div style="margin-top: 8px;">
                    <textarea 
                      id="suggestion-${record.sheetName}" 
                      class="suggestion-input"
                      placeholder="ì´ ê¸°ë¡ì— ëŒ€í•œ ê±´ì˜ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..."
                      rows="3">${record.suggestion || ''}</textarea>
                    <button 
                      class="suggestion-save-btn" 
                      onclick="saveSuggestion('${record.sheetName}')">
                      ì €ì¥
                    </button>
                  </div>
                </div>
              `;
            }

            card.innerHTML = html;
            listEl.appendChild(card);
          });
        } else {
          showMessage('recordsMessage', result.message, 'error');
        }
      } catch (error) {
        console.error('Load my records error:', error);
        showMessage('recordsMessage', 'ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      }
    }

    // ê±´ì˜ì‚¬í•­ ì €ì¥
    async function saveSuggestion(sheetName) {
      const textareaId = `suggestion-${sheetName}`;
      const textarea = document.getElementById(textareaId);
      const suggestion = textarea.value.trim();
      
      // ë²„íŠ¼ ì°¾ê¸°
      const saveBtn = textarea.nextElementSibling;
      const originalText = saveBtn.textContent;
      
      try {
        // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
        saveBtn.disabled = true;
        saveBtn.textContent = 'ì €ì¥ ì¤‘...';
        
        const response = await fetch(`${API_BASE}/my-records`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            studentId: currentStudentId,
            sheetName: sheetName,
            suggestion: suggestion
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          showMessage('recordsMessage', 'ê±´ì˜ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          
          // ì €ì¥ ì„±ê³µ ì‹œ ë²„íŠ¼ ìƒ‰ìƒ ë³€ê²½
          saveBtn.style.backgroundColor = '#28a745';
          saveBtn.textContent = 'ì €ì¥ë¨';
          
          // 3ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì›
          setTimeout(() => {
            saveBtn.style.backgroundColor = '';
            saveBtn.textContent = originalText;
            saveBtn.disabled = false;
          }, 3000);
        } else {
          showMessage('recordsMessage', result.message, 'error');
          saveBtn.disabled = false;
          saveBtn.textContent = originalText;
        }
        
      } catch (error) {
        console.error('Save suggestion error:', error);
        showMessage('recordsMessage', 'ê±´ì˜ì‚¬í•­ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
        saveBtn.disabled = false;
        saveBtn.textContent = originalText;
      }
    }

    // ==================== í‰ê°€ ì‹œìŠ¤í…œ í•¨ìˆ˜ ====================

    // í•™ìƒìš© í‰ê°€ ê²°ê³¼ ì¡°íšŒ
    async function loadMyEvaluations() {
      const listEl = document.getElementById('evaluationsList');
      listEl.innerHTML = '<p style="text-align: center; color: #999;">í‰ê°€ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';

      try {
        const response = await fetch(`${API_BASE}/evaluation-results/my?studentId=${currentStudentId}`);
        const result = await response.json();

        if (result.success) {
          if (result.evaluations.length === 0) {
            listEl.innerHTML = '<div class="empty-state"><p>í‰ê°€ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>';
            return;
          }

          listEl.innerHTML = '';
          result.evaluations.forEach(evaluation => {
            const card = document.createElement('div');
            card.className = 'evaluation-result-card';

            const percentage = Math.round((evaluation.totalScore / evaluation.maxScore) * 100);
            
            let html = `
              <h3>
                ${evaluation.name}
                <span class="evaluation-score">${evaluation.totalScore}/${evaluation.maxScore} (${percentage}%)</span>
              </h3>
              <div class="evaluation-meta">
                <strong>ìœ í˜•:</strong> ${evaluation.type} | 
                <strong>í‰ê°€ì¼:</strong> ${evaluation.evaluateDate}
              </div>
            `;

            if (evaluation.description) {
              html += `<p style="margin-bottom: 1rem; color: #666;">${evaluation.description}</p>`;
            }

            html += '<div class="evaluation-items">';
            evaluation.items.forEach(item => {
              const itemPercentage = Math.round((item.score / item.maxPoints) * 100);
              html += `
                <div class="evaluation-item">
                  <div class="item-name">${item.name}</div>
                  <div class="item-score">
                    <span class="item-score-value">${item.score}/${item.maxPoints}</span>
                    <span style="color: #999;">(${itemPercentage}%)</span>
                  </div>
                </div>
              `;
              if (item.comment) {
                html += `<div class="item-comment">ğŸ’¬ ${item.comment}</div>`;
              }
            });
            html += '</div>';

            card.innerHTML = html;
            listEl.appendChild(card);
          });
        } else {
          showMessage('evaluationsMessage', result.message, 'error');
        }
      } catch (error) {
        console.error('Load my evaluations error:', error);
        showMessage('evaluationsMessage', 'í‰ê°€ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      }
    }

    // êµì‚¬ìš© í‰ê°€í•­ëª© ê´€ë¦¬ ëª©ë¡ ë¡œë“œ
    async function loadEvaluationManageList() {
      const listEl = document.getElementById('evaluationManageList');
      listEl.innerHTML = '<p style="text-align: center; color: #999;">í‰ê°€í•­ëª©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';

      try {
        const response = await fetch(`${API_BASE}/evaluations`);
        const result = await response.json();

        if (result.success) {
          if (result.evaluations.length === 0) {
            listEl.innerHTML = '<div class="empty-state"><p>ë“±ë¡ëœ í‰ê°€í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
            return;
          }

          listEl.innerHTML = '';
          result.evaluations.forEach(evaluation => {
            const card = document.createElement('div');
            card.className = 'evaluation-card';

            card.innerHTML = `
              <h4>${evaluation.name}</h4>
              <div class="evaluation-meta">
                <span>ğŸ·ï¸ ${evaluation.type}</span> | 
                <span>ğŸ“Š ${evaluation.totalPoints}ì </span> | 
                <span>ğŸ‘¥ ${evaluation.targetClass}</span> | 
                <span>ğŸ“… ${evaluation.createdDate}</span>
              </div>
              <p style="color: #666; margin-bottom: 1rem;">${evaluation.description || 'ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.'}</p>
              <div class="evaluation-actions">
                <button class="btn-secondary" onclick="editEvaluation('${evaluation.id}')">ìˆ˜ì •</button>
                <button class="btn-primary" onclick="inputScores('${evaluation.id}')">ì ìˆ˜ ì…ë ¥</button>
                <button class="btn-danger" onclick="deleteEvaluation('${evaluation.id}')">ì‚­ì œ</button>
              </div>
            `;

            listEl.appendChild(card);
          });
        } else {
          showMessage('manageMessage', result.message, 'error');
        }
      } catch (error) {
        console.error('Load evaluation manage list error:', error);
        showMessage('manageMessage', 'í‰ê°€í•­ëª©ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      }
    }

    // ì ìˆ˜ ì…ë ¥ìš© í‰ê°€ ëª©ë¡ ë¡œë“œ
    async function loadEvaluationList() {
      const selectEl = document.getElementById('evaluationSelect');
      selectEl.innerHTML = '<option value="">í‰ê°€ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';

      try {
        const response = await fetch(`${API_BASE}/evaluations`);
        const result = await response.json();

        if (result.success) {
          result.evaluations.forEach(evaluation => {
            const option = document.createElement('option');
            option.value = evaluation.id;
            option.textContent = `${evaluation.name} (${evaluation.type})`;
            selectEl.appendChild(option);
          });
        }
      } catch (error) {
        console.error('Load evaluation list error:', error);
      }
    }

    // í‰ê°€ ì„ íƒ ì‹œ ì ìˆ˜ ì…ë ¥ í…Œì´ë¸” ë¡œë“œ
    async function loadEvaluationForScoring() {
      const evaluationId = document.getElementById('evaluationSelect').value;
      const contentEl = document.getElementById('scoreInputContent');

      if (!evaluationId) {
        contentEl.classList.add('hidden');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/evaluation-results?evaluationId=${evaluationId}`);
        const result = await response.json();

        if (result.success) {
          // í‰ê°€ ì •ë³´ í‘œì‹œ
          document.getElementById('selectedEvalName').textContent = result.evaluation.name;
          document.getElementById('selectedEvalDesc').textContent = result.evaluation.description || '';

          // í…Œì´ë¸” ìƒì„±
          createScoreTable(result.evaluation, result.items, result.students, result.existingResults);
          contentEl.classList.remove('hidden');
        } else {
          showMessage('scoreMessage', result.message, 'error');
        }
      } catch (error) {
        console.error('Load evaluation for scoring error:', error);
        showMessage('scoreMessage', 'í‰ê°€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      }
    }

    // ì ìˆ˜ ì…ë ¥ í…Œì´ë¸” ìƒì„±
    function createScoreTable(evaluation, items, students, existingResults) {
      const table = document.getElementById('scoreTable');
      const thead = table.querySelector('thead tr');
      const tbody = table.querySelector('tbody');

      // í—¤ë” ìƒì„±
      thead.innerHTML = '<th>í•™ë²ˆ</th><th>ì´ë¦„</th><th>ë°˜</th>';
      items.forEach(item => {
        thead.innerHTML += `<th>${item.name}<br><small>(${item.points}ì )</small></th>`;
      });
      thead.innerHTML += '<th>ì´ì </th><th>ì½”ë©˜íŠ¸</th>';

      // ë°ì´í„° í–‰ ìƒì„±
      tbody.innerHTML = '';
      students.forEach(student => {
        const row = document.createElement('tr');
        
        let html = `
          <td>${student.studentId}</td>
          <td>${student.name}</td>
          <td>${student.class}</td>
        `;

        let totalScore = 0;
        items.forEach(item => {
          const existingScore = existingResults[student.studentId]?.[item.itemId]?.score || '';
          const existingComment = existingResults[student.studentId]?.[item.itemId]?.comment || '';
          
          html += `
            <td>
              <input type="number" 
                     class="score-input" 
                     data-student="${student.studentId}" 
                     data-item="${item.itemId}"
                     data-max="${item.points}"
                     value="${existingScore}" 
                     min="0" 
                     max="${item.points}"
                     onchange="updateTotalScore(this)">
            </td>
          `;
          
          if (existingScore) {
            totalScore += parseFloat(existingScore) || 0;
          }
        });

        html += `
          <td class="total-score" data-student="${student.studentId}">${totalScore || ''}</td>
          <td>
            <input type="text" 
                   class="comment-input" 
                   data-student="${student.studentId}"
                   value="${existingResults[student.studentId] ? Object.values(existingResults[student.studentId])[0]?.comment || '' : ''}"
                   placeholder="ì „ì²´ ì½”ë©˜íŠ¸">
          </td>
        `;

        row.innerHTML = html;
        tbody.appendChild(row);
      });
    }

    // ì´ì  ì—…ë°ì´íŠ¸
    function updateTotalScore(input) {
      const studentId = input.dataset.student;
      const row = input.closest('tr');
      const scoreInputs = row.querySelectorAll('.score-input[data-student="' + studentId + '"]');
      const totalCell = row.querySelector('.total-score[data-student="' + studentId + '"]');

      let total = 0;
      scoreInputs.forEach(scoreInput => {
        const score = parseFloat(scoreInput.value) || 0;
        const max = parseFloat(scoreInput.dataset.max) || 0;
        
        // ìµœëŒ€ì ìˆ˜ ì´ˆê³¼ ë°©ì§€
        if (score > max) {
          scoreInput.value = max;
          total += max;
        } else {
          total += score;
        }
      });

      totalCell.textContent = total;
    }

    // ëª¨ë“  ì ìˆ˜ ì €ì¥
    async function saveAllScores() {
      const evaluationId = document.getElementById('evaluationSelect').value;
      const saveBtn = document.getElementById('saveScoresBtn');
      const originalText = saveBtn.textContent;

      if (!evaluationId) {
        alert('í‰ê°€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      // ì ìˆ˜ ë°ì´í„° ìˆ˜ì§‘
      const results = [];
      const scoreInputs = document.querySelectorAll('.score-input');
      const commentInputs = document.querySelectorAll('.comment-input');

      scoreInputs.forEach(input => {
        const studentId = input.dataset.student;
        const itemId = input.dataset.item;
        const score = parseFloat(input.value) || 0;
        
        // í•´ë‹¹ í•™ìƒì˜ ì½”ë©˜íŠ¸ ì°¾ê¸°
        const commentInput = Array.from(commentInputs).find(c => c.dataset.student === studentId);
        const comment = commentInput ? commentInput.value : '';

        if (score > 0) { // ì ìˆ˜ê°€ ì…ë ¥ëœ ê²½ìš°ë§Œ
          results.push({
            studentId: studentId,
            itemId: itemId,
            score: score,
            comment: comment
          });
        }
      });

      if (results.length === 0) {
        alert('ì…ë ¥ëœ ì ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      try {
        saveBtn.disabled = true;
        saveBtn.textContent = 'ì €ì¥ ì¤‘...';

        const response = await fetch(`${API_BASE}/evaluation-results`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            evaluationId: evaluationId,
            results: results,
            teacherName: 'êµì‚¬' // ì‹¤ì œë¡œëŠ” ë¡œê·¸ì¸í•œ êµì‚¬ëª… ì‚¬ìš©
          })
        });

        const result = await response.json();

        if (result.success) {
          showMessage('scoreMessage', `${result.savedCount}ê°œì˜ ì ìˆ˜ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
          
          // 3ì´ˆ í›„ ìƒˆë¡œê³ ì¹¨
          setTimeout(() => {
            loadEvaluationForScoring();
          }, 2000);
        } else {
          showMessage('scoreMessage', result.message, 'error');
        }

      } catch (error) {
        console.error('Save scores error:', error);
        showMessage('scoreMessage', 'ì ìˆ˜ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        saveBtn.disabled = false;
        saveBtn.textContent = originalText;
      }
    }

    // ìƒˆ í‰ê°€ ìƒì„± ëª¨ë‹¬ í‘œì‹œ
    function showNewEvaluationModal() {
      document.getElementById('newEvaluationModal').classList.remove('hidden');
      document.getElementById('newEvaluationForm').reset();
    }

    // ìƒˆ í‰ê°€ ìƒì„± ëª¨ë‹¬ ìˆ¨ê¹€
    function hideNewEvaluationModal() {
      document.getElementById('newEvaluationModal').classList.add('hidden');
    }

    // í‰ê°€í•­ëª© ì¶”ê°€
    function addEvalItem() {
      const container = document.getElementById('evalItems');
      const newItem = document.createElement('div');
      newItem.className = 'eval-item';
      newItem.innerHTML = `
        <input type="text" placeholder="í•­ëª©ëª…" class="item-name" required>
        <input type="number" placeholder="ë°°ì " class="item-points" min="1" required>
        <input type="text" placeholder="í‰ê°€ê¸°ì¤€ (ì„ íƒ)" class="item-criteria">
        <button type="button" onclick="removeEvalItem(this)">ì‚­ì œ</button>
      `;
      container.appendChild(newItem);
    }

    // í‰ê°€í•­ëª© ì‚­ì œ
    function removeEvalItem(button) {
      const container = document.getElementById('evalItems');
      if (container.children.length > 1) {
        button.closest('.eval-item').remove();
      } else {
        alert('ìµœì†Œ 1ê°œì˜ í‰ê°€í•­ëª©ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      }
    }

    // ìƒˆ í‰ê°€ ìƒì„±
    async function createNewEvaluation(event) {
      event.preventDefault();
      
      const form = event.target;
      const submitBtn = form.querySelector('.submit-btn');
      const originalText = submitBtn.textContent;

      // í¼ ë°ì´í„° ìˆ˜ì§‘
      const name = document.getElementById('evalName').value;
      const description = document.getElementById('evalDescription').value;
      const type = document.getElementById('evalType').value;
      const totalPoints = parseInt(document.getElementById('evalPoints').value);
      const targetClass = document.getElementById('evalTarget').value;

      // ì„¸ë¶€í•­ëª© ìˆ˜ì§‘
      const items = [];
      const evalItems = document.querySelectorAll('.eval-item');
      
      evalItems.forEach(item => {
        const itemName = item.querySelector('.item-name').value;
        const itemPoints = parseInt(item.querySelector('.item-points').value);
        const itemCriteria = item.querySelector('.item-criteria').value;
        
        if (itemName && itemPoints) {
          items.push({
            name: itemName,
            points: itemPoints,
            criteria: itemCriteria
          });
        }
      });

      // ì´ë°°ì  ê²€ì¦
      const itemsTotal = items.reduce((sum, item) => sum + item.points, 0);
      if (itemsTotal !== totalPoints) {
        alert(`ì„¸ë¶€í•­ëª© ë°°ì  í•©ê³„(${itemsTotal}ì )ê°€ ì´ë°°ì (${totalPoints}ì )ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`);
        return;
      }

      try {
        submitBtn.disabled = true;
        submitBtn.textContent = 'ìƒì„± ì¤‘...';

        const response = await fetch(`${API_BASE}/evaluations`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            name: name,
            description: description,
            type: type,
            totalPoints: totalPoints,
            targetClass: targetClass,
            items: items
          })
        });

        const result = await response.json();

        if (result.success) {
          showMessage('manageMessage', 'í‰ê°€í•­ëª©ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          hideNewEvaluationModal();
          loadEvaluationManageList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        } else {
          alert(result.message);
        }

      } catch (error) {
        console.error('Create evaluation error:', error);
        alert('í‰ê°€í•­ëª© ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    }

    // í‰ê°€ ì ìˆ˜ ì…ë ¥ (í‰ê°€í•­ëª© ê´€ë¦¬ì—ì„œ)
    function inputScores(evaluationId) {
      showScreen('scoreInputScreen');
      document.getElementById('evaluationSelect').value = evaluationId;
      loadEvaluationForScoring();
    }

    // í‰ê°€ ìˆ˜ì • (ì¶”í›„ êµ¬í˜„)
    function editEvaluation(evaluationId) {
      alert('í‰ê°€ ìˆ˜ì • ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.');
    }

    // í‰ê°€ ì‚­ì œ (ì¶”í›„ êµ¬í˜„)
    function deleteEvaluation(evaluationId) {
      if (confirm('ì´ í‰ê°€í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        alert('í‰ê°€ ì‚­ì œ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.');
      }
    }

    // ==================== êµì‚¬ ì¸ì¦ í•¨ìˆ˜ ====================

    // êµì‚¬ ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ
    function showTeacherLoginModal() {
      document.getElementById('teacherLoginModal').classList.remove('hidden');
      document.getElementById('teacherPassword').value = '';
      document.getElementById('teacherLoginMessage').className = 'message';
      document.getElementById('teacherLoginMessage').textContent = '';
    }

    // êµì‚¬ ë¡œê·¸ì¸ ëª¨ë‹¬ ìˆ¨ê¹€
    function hideTeacherLoginModal() {
      document.getElementById('teacherLoginModal').classList.add('hidden');
    }

    // êµì‚¬ ì¸ì¦
    function authenticateTeacher(event) {
      event.preventDefault();
      
      const password = document.getElementById('teacherPassword').value;
      const messageEl = document.getElementById('teacherLoginMessage');
      
      if (password === TEACHER_PASSWORD) {
        isTeacherMode = true;
        hideTeacherLoginModal();
        showScreen('teacherModeScreen');
        
        // ë©”ë‰´ í™”ë©´ì—ì„œ êµì‚¬ ëª¨ë“œ í‘œì‹œ
        updateMenuForTeacherMode();
        
        messageEl.className = 'message';
        messageEl.textContent = '';
      } else {
        messageEl.className = 'message show error';
        messageEl.textContent = 'ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.';
        
        // 3ì´ˆ í›„ ë©”ì‹œì§€ ìˆ¨ê¹€
        setTimeout(() => {
          messageEl.className = 'message';
        }, 3000);
      }
    }

    // êµì‚¬ ëª¨ë“œìš© ë©”ë‰´ ì—…ë°ì´íŠ¸
    function updateMenuForTeacherMode() {
      const teacherBtn = document.getElementById('teacherModeBtn');
      if (isTeacherMode) {
        teacherBtn.textContent = 'ğŸ‘¨â€ğŸ« êµì‚¬ ëª¨ë“œ (í™œì„±)';
        teacherBtn.style.backgroundColor = '#28a745';
      } else {
        teacherBtn.textContent = 'ğŸ‘¨â€ğŸ« êµì‚¬ ëª¨ë“œ';
        teacherBtn.style.backgroundColor = '';
      }
    }

    // êµì‚¬ ëª¨ë“œ ì¢…ë£Œ
    function exitTeacherMode() {
      isTeacherMode = false;
      updateMenuForTeacherMode();
      showScreen('menuScreen');
    }
  </script>
</body>
</html>
